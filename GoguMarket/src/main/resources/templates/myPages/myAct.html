<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://ultraq.net/thymeleaf/layout"
	layout:decorate="~{myPages/sideBar/sideBar}">

<head>
	<meta charset="UTF-8">
	<title>ë‚˜ì˜ ê³„ì¢Œ ê´€ë¦¬ğŸ€</title>
	<style>
		.dropbtn {
			padding: 16px;
			font-size: 16px;
			border: none;
			cursor: pointer;
		}

		.dropdown {
			position: relative;
			display: inline-block;
		}

		.dropdown-content {
			display: none;
			position: absolute;
			min-width: 100px;
			overflow: auto;
			box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
		}

		.dropdown-content a {
			color: black;
			padding: 12px 16px;
			text-decoration: none;
			display: block;
		}

		.dropdown a:hover {
			background-color: #f1f1f1
		}

		.show {
			display: block;
		}
	</style>

	<script>
		//â–¶ ì „ì²´ ì •ë³´ ê°€ì ¸ì˜¤ëŠ” ì•„ì‘ìŠ¤(ëŒ€í‘œê³„ì¢Œ, ê³„ì¢Œ ì „ì²´ ëª©ë¡)
		$(function(){
			actInfoAjax();
			var memActNo = '';
		})
		function actInfoAjax(){
			$.ajax({
			url: "/actInfoAjax",
			type: 'get',
			dataType: 'json',
			contentType: 'application/json; charset = utf-8',
			success: function (result) {
				memActMake(result.memAct); //â†’ ëŒ€í‘œê³„ì¢Œ
				actListMake(result.actList); //â†’ ê³„ì¢Œ ì „ì²´ ëª©ë¡ 
			},
			error: function (err) {
				console.log(err);
			}
		})
		}

		//â–¶ ê³„ì¢Œ ì „ì²´ ëª©ë¡
		function actListMake(actList){
							//â†‘ actList íƒ€ì… == ê°ì²´(object) (* íƒ€ì… í™•ì¸í•˜ëŠ” ë°©ë²• : console.log(typeof(í™•ì¸í•˜ê³ ì í•˜ëŠ” ê²ƒ));)
			//â†“ forë¬¸ ëŒë©´ì„œ ê°ì²´ì˜ ê°’ì„ í•˜ë‚˜ì”© êº¼ë‚´ì¤Œ
			let cnt = 0; 
			for(let actListIdx in actList) {
				    //â†‘ actListIdx == ì¸ë±ìŠ¤(0,1,2, ... )
				++cnt;
			makeTbody(actList[actListIdx]); //â†’ actList[actListIdx] == auctListì˜ actListIdxë²ˆì§¸ ê°’
		}

		// # ë“±ë¡ëœ ê³„ì¢Œê°€ 3ê°œ ë¯¸ë§Œì´ë©´ ë“±ë¡ ë²„íŠ¼ ì¶œë ¥
		//ğŸ“Œ ë°‘ì— onclick ì´ë²¤íŠ¸ ìˆ˜ì •í•´ì•¼~!
		if(cnt < 3){
			for(let i=1 ; i< (4-Number(cnt)) ; i++){
				$("#actListTable").children().eq(1).append(
				`
				<tr>
					<td colspan="3">
						<button onclick="goMemAct()" type = "button">ê³„ì¢Œ ì¶”ê°€</button>
					</td>
				</tr>
				`)
			}
		}
		}

		//â–· Tbody ë§Œë“¤ê¸°
		function makeTbody(act){
			$("#actListTable").children().eq(1).append(
				`
				<tr id=${act.actNo}>
					<td>${act.bankNm}</td>
					<td>${act.bankActNo}</td>
					<td>
						<button onclick="deleteActListOne(event)" type = "button">ì‚­ì œ</button>
						<button onclick="updateMemActAjax(event)" type = "button">ëŒ€í‘œê³„ì¢Œë¡œ ì„¤ì •</button>
					</td>
				</tr>
				`
			)
		}

		//â–· ì „ì²´ ê³„ì¢Œì—ì„œ í•œ ê°œ ì‚­ì œ
		function deleteActListOne(event){
			let actNo = $(event.target).parent().parent().attr('id');
			let memActNoYn = 'N';
			if(actNo == memActNo){
				memActNoYn = "Y"
			}

			$.ajax({
				url: "/deleteActListOne/"+actNo+"/"+memActNoYn,
				type: 'get',
				dataType: 'json',
				contentType: 'application/json; charset = utf-8',
				success: function (result) {
					deleteActListOneAfter(result, actNo, memActNoYn);
				},
				error: function (err) {
					console.log(err);
				}
			})
		}
		//â–· ì „ì²´ ê³„ì¢Œ ì¤‘ í•œ ê°œ DB ì‚­ì œ ì´í›„
		function deleteActListOneAfter(result, actNo, memActNoYn){
			if(result.result != 1){
				alert("[ê³„ì¢Œ ì‚­ì œ ì‹¤íŒ¨] ê³„ì¢Œ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤. :()")
			}else{
				alert("[ê³„ì¢Œ ì‚­ì œ ì„±ê³µ] ê³„ì¢Œë¥¼ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œí•˜ì˜€ìŠµë‹ˆë‹¤. :D)")
				$("#"+actNo).remove();
				$("#actListTable").children().eq(1).append(
				`
				<tr>
					<td colspan="3">
						<button onclick="goMemAct()" type = "button">ê³„ì¢Œ ì¶”ê°€</button>
					</td>
				</tr>

				`)
				if(memActNoYn == "Y"){
					memActNo = '';
					// # ëŒ€í‘œê³„ì¢Œ í™”ë©´ì—ì„œ ì§€ìš°ê¸°
					$("#memActSection").children().eq(1).children().remove();

					// # ëŒ€í‘œê³„ì¢Œ ë“±ë¡í•˜ë¼ëŠ” ë¬¸êµ¬ ì¶œë ¥í•˜ê¸°
					$("#memActSection").children().eq(1).append(
						$("<p>").text("ëŒ€í‘œê³„ì¢Œë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš” :D").css('font-size', 'medium'));
				}

			}
		}

		//â–· ëŒ€í‘œê³„ì¢Œë¡œ ì„¤ì •í•˜ê¸°
		function updateMemActAjax(event){
			let actNo = $(event.target).parent().parent().attr('id');

			if(actNo ==memActNo){
				alert("ì´ë¯¸ ëŒ€í‘œê³„ì¢Œë¡œ ë“±ë¡ë˜ì–´ìˆëŠ” ê³„ì¢Œë²ˆí˜¸ì…ë‹ˆë‹¤ :D");
			}
			else{
				$.ajax({
				url: "/updateMemActAjax/"+actNo,
				type: 'get',
				dataType: 'json',
				contentType: 'application/json; charset = utf-8',
				success: function (result) {
					updateMemActAjaxAfter(result.result);
				},
				error: function (err) {
					console.log(err);
				}
			})
			}
			
		}

		//â–· ëŒ€í‘œê³„ì¢Œ ì„¤ì • ë³€ê²½ ì´í›„
		function updateMemActAjaxAfter(result){
			if(result=="fail"){
				alert("[ëŒ€í‘œê³„ì¢Œ ë³€ê²½ ì‹¤íŒ¨] ëŒ€í‘œê³„ì¢Œ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤. :()")
			}else{
				alert("[ëŒ€í‘œê³„ì¢Œ ë³€ê²½ ì„±ê³µ] ëŒ€í‘œê³„ì¢Œë¥¼ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½í•˜ì˜€ìŠµë‹ˆë‹¤ :D");
				memActNo = result.actNo;

				$("#memActSection").children().eq(1).html(
					`
				<img src="attech/222.jpg" alt="" style="width: 60px; height: 60px; border-radius: 70%; overflow: hidden;">
				<span class="ml-20" style="width: 25%; font-size: large;">${result.bankNm}</span> 
				<span class="ml-20" style="width: 25%; font-size: large;">${result.bankActNo}</span>
				<div class="dropdown">
					<button onclick="myFunction()" class="dropbtn">Dropdown</button>
					<div id="myDropdown" class="dropdown-content">
						<a onclick="delMemActAjax()">ì‚­ì œ</a>
					</div>
				</div>
				`
				)
			}
		}

		//â–¶ ëŒ€í‘œê³„ì¢Œ 
		//â–· ëŒ€í‘œê³„ì¢Œ ê·¸ë¦¬ê¸°
		function memActMake(result) {
			// # ëŒ€í‘œê³„ì¢Œ ì—†ì„ ë•Œ(== BankNmì´ Nothingì¼ ë•Œ) : ëŒ€í‘œê³„ì¢Œ ë“±ë¡í•˜ë¼ëŠ” ë¬¸êµ¬ ì¶œë ¥
			if (result == "Nothing") {
				$("#memActSection").children().eq(1).append(
					$("<p>").text("ëŒ€í‘œê³„ì¢Œë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš” :D").css('font-size', 'medium'))

				//# ëŒ€í‘œê³„ì¢Œ ìˆì„ ë•Œ : ëŒ€í‘œê³„ì¢Œ ì •ë³´ ì¶œë ¥
			} else {
				memActNo = result.actNo;
				$("#memActSection").children().eq(1).html(
					`
				<img src="attech/222.jpg" alt="" style="width: 60px; height: 60px; border-radius: 70%; overflow: hidden;">
				<span class="ml-20" style="width: 25%; font-size: large;">${result.bankNm}</span> 
				<span class="ml-20" style="width: 25%; font-size: large;">${result.bankActNo}</span>
				<div class="dropdown">
					<button onclick="myFunction()" class="dropbtn">Dropdown</button>
					<div id="myDropdown" class="dropdown-content">
						<a onclick="delMemActAjax()">ì‚­ì œ</a>
					</div>
				</div>
				`
				)
			}
		}

		//â–· ëŒ€í‘œê³„ì¢Œ ë“œë¡­ë‹¤ìš´ ë²„íŠ¼ : http://www.w3bai.com/ko/howto/howto_js_dropdown.html ì°¸ê³ 
		function myFunction() {
			document.getElementById("myDropdown").classList.toggle("show");
		}
		window.onclick = function (event) {
			if (!event.target.matches('.dropbtn')) {
				var dropdowns = document.getElementsByClassName("dropdown-content");
				var i;
				for (i = 0; i < dropdowns.length; i++) {
					var openDropdown = dropdowns[i];
					if (openDropdown.classList.contains('show')) {
						openDropdown.classList.remove('show');
					}
				}
			}
		}

		//â–· ëŒ€í‘œê³„ì¢Œ ì‚­ì œ ì•„ì‘ìŠ¤
		function delMemActAjax() {
			$.ajax({
				url: "/delMemActAjax",
				type: 'get',
				dataType: 'json',
				contentType: 'application/json; charset = utf-8',
				success: function (result) {
					delMemActAjaxAfter(result.result);
				},
				error: function (error) {
					console.log(error);
				}
			})
		}

		//â–· ëŒ€í‘œê³„ì¢Œ DB ì‚­ì œ í›„  
		function delMemActAjaxAfter(data) {
			if (data == "success") {
				alert("[ëŒ€í‘œê³„ì¢Œ ì‚­ì œ ì„±ê³µ] ê³„ì¢Œê°€ ì •ìƒì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
				memActNo = '';

				// # ëŒ€í‘œê³„ì¢Œ í™”ë©´ì—ì„œ ì§€ìš°ê¸°
				$("#memActSection").children().eq(1).children().remove();

				// # ëŒ€í‘œê³„ì¢Œ ë“±ë¡í•˜ë¼ëŠ” ë¬¸êµ¬ ì¶œë ¥í•˜ê¸°
				$("#memActSection").children().eq(1).append(
					$("<p>").text("ëŒ€í‘œê³„ì¢Œë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš” :D").css('font-size', 'medium'));
			} else {
				//# ëŒ€í‘œê³„ì¢Œ ì‚­ì œ ì‹¤íŒ¨ì‹œ
				alert("[ëŒ€í‘œê³„ì¢Œ ì‚­ì œ ì‹¤íŒ¨] ê³„ì¢Œ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.")
			}
		}
	</script>
</head>

<body>
	<div layout:fragment="myContent">
		<div class="wrapper">
			<section id="page-content" class="page-wrapper section">
				<div class="about-section mb-80">
					<div class="container">
						<!--â–¶ ëŒ€í‘œê³„ì¢Œ -->
						<div class="row mb-100" id="memActSection">
								<div class="section-title text-start ">
									<h2 class="uppercase">ë‚˜ì˜ ê³„ì¢Œ</h2>
									<hr>
									<h3 style="font-weight: bold;">ëŒ€í‘œê³„ì¢Œ</h3>
								</div>
							<div class="mt-20"></div>
						</div>
						
						<!--â–¶ ì „ì²´ ê³„ì¢Œ ëª©ë¡-->
						<div class="row" >
								<div class="section-title text-start mb-20">
									<hr>
									<h3 style="font-weight: bold;">ê³„ì¢Œëª©ë¡</h3>
									<p>ê³„ì¢ŒëŠ” ìµœëŒ€ 3ê°œê¹Œì§€ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
								</div>
								<div style="text-align: center">
									<table class="table" id="actListTable">
										<thead>
											<tr>
												<th>ì€í–‰ëª…</th>
												<th>ê³„ì¢Œë²ˆí˜¸</th>
												<th></th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</div>
						</div>
					</div>
				</div>
			</section>

		</div>


	</div>
</body>

</html>